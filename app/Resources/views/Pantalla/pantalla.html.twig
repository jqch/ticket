{% extends 'fullscreen.html.twig' %}
{% block stylesheets %}
	{{parent()}}
	<style>
		#cuerpo{
			width: 100%;
			height: 90%;
			min-height: 90%;
			background-color: #000000;
		}
		#video{
			width: 75%;
			min-width: 75%;
			height: 100%;
			background-color: #050202;
			float: left;
		}
		#logo{
			width: 100%;
			height: 20%;
		}
		#botones{
			width: 25%;
			min-width: 25%;
			height: 100%;
			background-color: #00372F;
			float: right;
		}
		#pie{
			width: 100%;
			height: 10%;
			min-height: 10%;
			background-color: #042A00;
			vertical-align: middle;
		}
		#texto{
			font-size: 3.5rem;
			color: #15CD00;
		}
		.marquee {
			display:flex;
			justify-content: center;
			align-content: center;
			flex-direction: column;

			width: 100%;
			height: 100%;
			font-size: 3.5rem;
			color: #FFFFFF;
		  	overflow: hidden;
		  	vertical-align: middle;
		}
		#hora{
			width: 100%;
			height: 40%;
		}
		.ficha{
			width: 100%;
			height: 20%;
			background-color: #00372F;
			border-top: 1px solid #006255;
		}

	</style>
{% endblock %}
{% block body %}
	<div id="content">
		<div id="cuerpo">
			<div id="video">
				<div id="logo"><img src="{{asset('img/logo.gif')}}" alt="" style="display:none"></div>
				<video id="reproductor" width="100%" height="80%" autoplay="true" controls></video>
			</div>
			<div id="botones">
				<div id="hora"></div>
				<div id="b1" class="ficha"></div>
				<div id="b2" class="ficha"></div>
				<div id="b3" class="ficha"></div>
			</div>
		</div>
		<div id="pie">
			<!--marquee direction="left" scrolldelay="1" id="texto" loop="1">
				hola
			</marquee-->
			<div class='marquee' id="marquee"></div>
			<input type="hidden" id="text" value="">
		</div>
	</div>
{% endblock %}
{% block javascripts %}
	{{parent()}}
	<script src="//cdn.jsdelivr.net/jquery.marquee/1.4.0/jquery.marquee.min.js" type="text/javascript"></script>
	<script>
		var xhr, xhr1;
		var nextVideo;

		/* Reproductor de video */

		$(function() {
			nextVideo = '/vid/'+'{{firstVideo}}';
			$('#reproductor').attr('src', nextVideo);
			$('#reproductor').play();
		});

		$('#reproductor').on('ended',function(){
			if (xhr && xhr.readyState != 4) {
	            xhr.abort();
	        }

	        var currentVideo = $('#reproductor').attr('src');

	        xhr = $.ajax({
	            type: 'post',
	            cache: false,
	            data: {currentVideo: currentVideo},
	            url: "{{ path('pantalla_next_video') }}",
	            beforeSend: function () {
					//$('#reproductor').attr('poster', 'img/poster-pantalla.gif');
	            },
	            success: function (data) {
	                $('#reproductor').stop();
					$('#reproductor').attr('src', '/vid/' + data.nextVideo );
					$('#reproductor').play();
	            },
	            statusCode: {
	                500: function () {
	                	nextVideo = '/vid/'+'{{firstVideo}}';
						$('#reproductor').attr('src', nextVideo);
						$('#reproductor').play();
	                },
	                404: function () {
	                	nextVideo = '/vid/'+'{{firstVideo}}';
						$('#reproductor').attr('src', nextVideo);
						$('#reproductor').play();
	                }
	            }
	        });
		});

		/* animaciones marquesina */

		$('.marquee').marquee();

		$('.marquee').bind('finished', function(){
			if (xhr1 && xhr1.readyState != 4) {
	            xhr1.abort();
	        }
			var currentText = $('#text').val();

			xhr1 = $.ajax({
	            type: 'post',
	            cache: false,
	            data: {currentText: currentText},
	            url: "{{ path('pantalla_next_text') }}",
	            beforeSend: function () {
					$('.marquee').empty();
	            },
	            success: function (data) {
	            	$('.marquee').empty();
	                $('.marquee').text(data.nextText);
	                $('.marquee').marquee({
	                	duration: 15000
	                });
	                $('#text').val(data.nextText);
	            },
	            statusCode: {
	                500: function () {
	                	$('.marquee').empty();
	                	$('.marquee').text('');
	                	$('.marquee').marquee();
	                	$('#text').val('');
	                },
	                404: function () {
	                	$('.marquee').empty();
	                	$('.marquee').text('');
	                	$('.marquee').marquee();
	                	$('#text').val('');
	                }
	            }
	        });
		});

		// Fichas
		$(document).ready(function(){

		});

	</script>
{% endblock %}
